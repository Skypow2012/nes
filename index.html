<!DOCTYPE html>

<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Embedding Example</title>
	<script type="text/javascript" src="./js/util.js"></script>
	<script type="text/javascript" src="./js/jsnes.min.js"></script>
	<script type="text/javascript" src="./js/nes-embed.js"></script>
	<script>
		window.onload = function () {
			nes_load_url("nes-canvas", "./rom/InterglacticTransmissing.nes");
			document.body.addEventListener("dragover", function (ev) {
				ev.preventDefault();
			});
			document.body.ondrop = function (ev) {
				ev.preventDefault();
				nes_load_local(ev.dataTransfer.files[0])
			}
			window.addEventListener('visibilitychange', (ev) => {
				console.log(document.visibilityState)
				if (document.visibilityState === 'hidden') {
					window.isStop = true;

					// 关闭音乐,防止噪音卡住
					window.audio_ctx.close();
				} else if (document.visibilityState === 'visible') {
					delete window.isStop;
				}
			});
			get('https://tekii.cn/market/fc/roms', function (resTxt) {
				window.games = JSON.parse(resTxt).info;
				search();
			})
		}
	</script>
	<style>
		a:focus,
		input:focus,
		#search-input:focus {
			-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
			-webkit-user-modify: read-write-plaintext-only;
			outline: none
		}

		#search-input,
		#game-list-box {
			position: absolute;
			left: 0;
			top: 0;
			padding: 0px 4px;
			width: 142px;
			line-height: 30px;
			font-size: 16px;
			color: #3cabff;
		}

		#search-input {
			border: 0;
			height: 30px;
			background-color: rgba(0, 0, 0, 0);
			box-sizing: border-box;
		}

		#game-list-box {
			top: 30px;
			bottom: 0;
			border-top: 2px solid #b15400;
			overflow: auto;
			overflow-x: hidden;
			box-sizing: border-box;
		}

		#game-list-box>p {
			height: 30px;
			line-height: 30px;
			margin: 0;
			word-break: keep-all;
			overflow: hidden;
		}

		#game-list-box>p:hover {
			background: #ccc;
			cursor: pointer;
		}

		#game-list-box::-webkit-scrollbar-track {
			background-color: rgba(0, 0, 0, 0);
		}

		#game-list-box::-webkit-scrollbar-track-piece {
			background-color: rgba(0, 0, 0, 0);
		}
		#search-input:focus + div,
		#search-input:hover + div {
			opacity: 1;
		}
		#game-list-box {
			opacity: 0;
			transition: opacity 3s;
		}
		#game-list-box:hover {
			opacity: 1;
		}

		::-webkit-scrollbar-thumb {
			border: 0;
		}

		::-webkit-scrollbar-thumb:hover {
			background: linear-gradient(rgb(17, 212, 105), rgb(17, 157, 212));
		}
	</style>
</head>

<body style="margin: 0;">
	<input id="search-input" onkeyup="search(this.value)" placeholder="搜索游戏"></input>
	<div id="game-list-box"></div>
	<div style="margin: auto; width: 512px;image-rendering: pixelated;">
		<canvas id="nes-canvas" width="256" height="240" style="width: 100%" />
	</div>
	<p style="text-align: center;text-shadow: 1px #fff;">DPad: Arrow keys, Start: Enter, Select: Tab, A Button: A, B
		Button: S</p>
</body>

</html>